{{ template "layouts/_header.html" }}

<div class="flex h-screen bg-gray-100" x-data="{ sidebarOpen: false }">
    <aside 
        :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'"
        class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform transition-transform duration-300 lg:relative lg:translate-x-0 lg:static lg:inset-0 flex flex-col flex-shrink-0"
    >
        <div class="p-4 border-b flex items-center justify-between lg:hidden">
            <h2 class="text-lg font-bold text-gray-800">Menu Staff</h2>
            <button @click="sidebarOpen = false" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="p-4 border-b hidden lg:block">
            <h2 class="text-lg font-bold text-gray-800">Menu Staff</h2>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            {{template "layouts/_staff_sidebar.html" (dict "ActiveMenu" "tickets")}}
        </nav>
    </aside>

    <div class="flex-1 flex flex-col overflow-hidden">
        <header class="bg-white shadow-sm border-b px-4 py-3 lg:hidden">
            <button @click="sidebarOpen = true" class="text-gray-700 hover:text-gray-900">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </header>

        <header class="bg-white shadow-sm border-b px-6 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-semibold text-gray-800">Kelola Tiket</h2>
                    <p class="text-sm text-gray-600 mt-1">Lihat dan kelola semua tiket antrian</p>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="openResetModal()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="fas fa-trash-alt mr-2"></i>
                        Reset Tiket Kemarin
                    </button>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-6">
            {{template "pages/staff/_stats_ticket.html" .}}

            <!-- Filters -->
            <div class="bg-white rounded-lg shadow p-4 mb-6">
                <form id="filterForm" class="flex flex-wrap gap-4 items-end" method="GET" action="/staff/tickets">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal Dari</label>
                        <input type="date" name="date_from" 
                               class="border rounded-lg px-3 py-2" value="{{.Filters.date_from}}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal Sampai</label>
                        <input type="date" name="date_to" 
                               class="border rounded-lg px-3 py-2" value="{{.Filters.date_to}}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select name="status" class="border rounded-lg px-3 py-2">
                            <option value="">Semua Status</option>
                            <option value="waiting" {{if eq .Filters.status "waiting"}}selected{{end}}>Menunggu</option>
                            <option value="serving" {{if eq .Filters.status "serving"}}selected{{end}}>Melayani</option>
                            <option value="completed" {{if eq .Filters.status "completed"}}selected{{end}}>Selesai</option>
                            <option value="no_show" {{if eq .Filters.status "no_show"}}selected{{end}}>Tidak Hadir</option>
                            <option value="cancelled" {{if eq .Filters.status "cancelled"}}selected{{end}}>Dibatalkan</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <button type="button" onclick="setQuickDateRange('today')" 
                                class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm">
                            Hari Ini
                        </button>
                        <button type="button" onclick="setQuickDateRange('week')" 
                                class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm">
                            Minggu Ini
                        </button>
                        <button type="button" onclick="setQuickDateRange('month')" 
                                class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm">
                            Bulan Ini
                        </button>
                    </div>
                    <div class="flex gap-2">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-filter mr-2"></i>Filter
                        </button>
                        <button type="button" onclick="clearFilters()" 
                                class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg">
                            Bersihkan
                        </button>
                    </div>
                    
                    <!-- Hidden fields for sorting -->
                    <input type="hidden" name="sort_by" id="sortByInput" value="{{.SortBy}}">
                    <input type="hidden" name="sort_order" id="sortOrderInput" value="{{.SortOrder}}">
                </form>
            </div>

            {{template "pages/staff/_list_ticket.html" .}}
        </main>
    </div>
    
    <div 
        x-show="sidebarOpen" 
        @click="sidebarOpen = false"
        x-transition.opacity
        class="fixed inset-0 bg-black/50 z-40 lg:hidden"
    ></div>
</div>

<!-- Ticket Detail Modal -->
{{template "pages/staff/_detail_ticket.html" .}}

<!-- Reset Modal -->
<div id="resetModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-red-600">Reset Tiket Kemarin</h3>
            <button onclick="closeResetModal()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="mb-4">
            <p class="text-gray-600">Apakah Anda yakin ingin membatalkan semua tiket kemarin?</p>
            <p class="text-sm text-gray-500 mt-2">Tiket dengan status "waiting" akan dibatalkan. Tiket yang sudah selesai tidak akan diubah.</p>
            <p class="text-sm text-red-500 mt-2 font-semibold">Tindakan ini tidak dapat dibatalkan!</p>
        </div>
        <div class="flex justify-end space-x-3">
            <button onclick="closeResetModal()"
                    class="px-4 py-2 text-gray-600 hover:text-gray-800">
                Batal
            </button>
            <button onclick="resetYesterdayTickets()"
                    class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg">
                Ya, Reset Tiket Kemarin
            </button>
        </div>
    </div>
</div>

<script src="/templates/pages/staff/ticket.js"></script>

{{ template "layouts/_footer.html" }}
