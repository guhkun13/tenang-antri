{{template "layouts/_header.html"}}

<div class="flex h-screen bg-gray-100">
  {{template "layouts/_admin_sidebar.html" .}}

  <!-- Main Content -->
  <div class="flex-1 flex flex-col overflow-hidden">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b px-6 py-4">
      <div class="flex justify-between items-center">
        <div>
          <h2 class="text-xl font-semibold text-gray-800">Dasbor</h2>
          <p class="text-sm text-gray-600 mt-1">
            Tinjauan manajemen antrian waktu nyata
          </p>
        </div>
        <div class="flex items-center space-x-4">
          <button
            onclick="refreshStats()"
            class="text-blue-600 hover:text-blue-800"
          >
            <i class="fas fa-sync-alt mr-2"></i>Perbarui
          </button>
          <div class="relative" x-data="{ open: false }">
            <button
              @click="open = !open"
              class="flex items-center space-x-2 text-gray-700 hover:text-gray-900"
            >
              <i class="fas fa-user-circle text-2xl"></i>
              <span>Admin</span>
              <i class="fas fa-chevron-down text-sm"></i>
            </button>
            <div
              x-show="open"
              @click.away="open = false"
              class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50"
            >
              <a href="/profile" class="block px-4 py-2 hover:bg-gray-100">
                <i class="fas fa-user mr-2"></i>Profil
              </a>
              <a
                href="/logout"
                class="block px-4 py-2 hover:bg-gray-100 text-red-600"
              >
                <i class="fas fa-sign-out-alt mr-2"></i>Keluar
              </a>
            </div>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <a
            href="/kiosk"
            target="_blank"
            class="text-blue-600 hover:text-blue-800"
          >
            <i class="fas fa-desktop mr-1"></i>Kiosk
          </a>
          <a
            href="/display"
            target="_blank"
            class="text-blue-600 hover:text-blue-800"
          >
            <i class="fas fa-tv mr-1"></i>Papan Tampilan
          </a>
        </div>
      </div>
    </header>

    <!-- Dashboard Content -->
    <main class="flex-1 overflow-y-auto p-6">
      <!-- Today's Performance Section -->
      <section class="mb-8">
        <div class="flex items-center mb-4">
          <div class="w-1 h-6 bg-blue-600 mr-3"></div>
          <h3 class="text-xl font-bold text-gray-800">Performa Hari Ini</h3>
          <span
            class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full"
          >
            {{now.Format "2006-01-02"}}
          </span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <!-- Tiket Hari Ini -->
          <div
            class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-lg p-6 text-white"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-blue-100 text-sm">Total Tiket</p>
                <p class="text-3xl font-bold">{{.Stats.TotalTicketsToday}}</p>
              </div>
              <div
                class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-ticket-alt text-2xl"></i>
              </div>
            </div>
            <div class="mt-4 space-y-2">
              {{range $key, $value := .Stats.TicketsByStatus}}
              <div class="flex justify-between text-sm">
                <span class="text-blue-100">{{$key}}:</span>
                <span class="font-bold">{{$value}}</span>
              </div>
              {{end}}
            </div>
          </div>

          <!-- Currently Serving -->
          <div
            class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg p-6 text-white"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-green-100 text-sm">Sedang Melayani</p>
                <p class="text-3xl font-bold">{{.Stats.CurrentlyServing}}</p>
              </div>
              <div
                class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-headset text-2xl"></i>
              </div>
            </div>
            <div class="mt-4">
              <div class="flex items-center space-x-4">
                <div class="text-center">
                  <p class="text-green-100 text-xs">Waktu Tunggu</p>
                  <p class="text-lg font-bold">
                    {{if gt .Stats.AvgWaitTime 0}} {{div .Stats.AvgWaitTime
                    60}}m {{else}} -- {{end}}
                  </p>
                </div>
                <div class="text-center">
                  <p class="text-green-100 text-xs">Waktu Layanan</p>
                  <p class="text-lg font-bold">
                    {{if gt .Stats.AvgServiceTime 0}} {{div
                    .Stats.AvgServiceTime 60}}m {{else}} -- {{end}}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Active Counters -->
          <div
            class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-lg p-6 text-white"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-purple-100 text-sm">Loket Aktif</p>
                <p class="text-3xl font-bold">{{.Stats.ActiveCounters}}</p>
              </div>
              <div
                class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-desktop text-2xl"></i>
              </div>
            </div>
            <div class="mt-4">
              <div class="flex items-center space-x-4">
                <div class="text-center">
                  <p class="text-purple-100 text-xs">Dijeda</p>
                  <p class="text-lg font-bold">{{.Stats.PausedCounters}}</p>
                </div>
                <div class="text-center">
                  <p class="text-purple-100 text-xs">Total</p>
                  <p class="text-lg font-bold">
                    {{add .Stats.ActiveCounters .Stats.PausedCounters}}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Waiting Queue -->
          <div
            class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg shadow-lg p-6 text-white"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-orange-100 text-sm">Antrian Menunggu</p>
                <p class="text-3xl font-bold">{{.Stats.WaitingTickets}}</p>
              </div>
              <div
                class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center"
              >
                <i class="fas fa-clock text-2xl"></i>
              </div>
            </div>
            <div class="mt-4">
              <div class="bg-white bg-opacity-20 rounded-lg p-3">
                <p class="text-xs">
                  Rata-rata waktu tunggu hari ini:
                  <strong>
                    {{if gt .Stats.AvgWaitTime 0}} {{div .Stats.AvgWaitTime
                    60}}m {{mod .Stats.AvgWaitTime 60}}s {{else}} Belum ada
                    waktu tunggu {{end}}
                  </strong>
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Overall Statistics Section -->
      <section class="mb-8">
        <div class="flex items-center mb-4">
          <div class="w-1 h-6 bg-green-600 mr-3"></div>
          <h3 class="text-xl font-bold text-gray-800">Statistik Keseluruhan</h3>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Queue by Category -->
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h4 class="text-lg font-semibold text-gray-800 mb-4">
              <i class="fas fa-chart-pie mr-2 text-blue-600"></i>Antrian per
              Kategori
            </h4>
            <div class="space-y-3">
              {{range .Stats.QueueLengthByCategory}}
              <div
                class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
              >
                <div class="flex items-center space-x-3">
                  <div
                    class="w-3 h-3 rounded-full"
                    style="background-color: {{if .ColorCode}}{{.ColorCode}}{{else}}#3B82F6{{end}}"
                  ></div>
                  <span class="text-gray-700 font-medium"
                    >{{.CategoryName}}</span
                  >
                </div>
                <div class="flex items-center space-x-3">
                  <span class="text-2xl font-bold text-gray-800"
                    >{{.WaitingCount}}</span
                  >
                  <span class="text-sm text-gray-500">antrian</span>
                </div>
              </div>
              {{else}}
              <div class="text-center py-8 text-gray-500">
                <i class="fas fa-inbox text-4xl mb-3 text-gray-300"></i>
                <p>Belum ada antrian</p>
              </div>
              {{end}}
            </div>
          </div>

          <!-- Hourly Distribution -->
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h4 class="text-lg font-semibold text-gray-800 mb-4">
              <i class="fas fa-chart-bar mr-2 text-green-600"></i>Distribusi per
              Jam
            </h4>
            {{if .Stats.HourlyDistribution}}
            <div class="space-y-3">
              {{range .Stats.HourlyDistribution}}
              <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-600 w-16">{{.Hour}}:00</span>
                <div class="flex-1 bg-gray-200 rounded-full h-4 relative">
                  {{$max := 0}} {{range $_, $h := $.Stats.HourlyDistribution}}
                  {{if gt $h.Count $max}}{{$max = $h.Count}}{{end}} {{end}}
                  <div
                    class="bg-gradient-to-r from-blue-500 to-blue-600 h-4 rounded-full"
                    style="width: {{if gt $max 0}}{{div (mul .Count 100) $max}}{{else}}0{{end}}%"
                  ></div>
                </div>
                <span class="text-sm font-bold text-gray-800 w-8"
                  >{{.Count}}</span
                >
              </div>
              {{end}}
            </div>
            {{else}}
            <div class="text-center py-8 text-gray-500">
              <i class="fas fa-chart-line text-4xl mb-3 text-gray-300"></i>
              <p>Belum ada data distribusi</p>
            </div>
            {{end}}
          </div>
        </div>

        <!-- Summary Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
          <div
            class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg p-4 text-white"
          >
            <p class="text-indigo-100 text-sm">Total Tiket Selesai</p>
            <p class="text-2xl font-bold">
              {{if
              .Stats.TicketsByStatus.completed}}{{.Stats.TicketsByStatus.completed}}{{else}}0{{end}}
            </p>
          </div>
          <div
            class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg p-4 text-white"
          >
            <p class="text-yellow-100 text-sm">Tiket Tidak Hadir</p>
            <p class="text-2xl font-bold">
              {{if
              .Stats.TicketsByStatus.no_show}}{{.Stats.TicketsByStatus.no_show}}{{else}}0{{end}}
            </p>
          </div>
          <div
            class="bg-gradient-to-br from-red-500 to-red-600 rounded-lg p-4 text-white"
          >
            <p class="text-red-100 text-sm">Tiket Dibatalkan</p>
            <p class="text-2xl font-bold">
              {{if
              .Stats.TicketsByStatus.cancelled}}{{.Stats.TicketsByStatus.cancelled}}{{else}}0{{end}}
            </p>
          </div>
          <div
            class="bg-gradient-to-br from-teal-500 to-teal-600 rounded-lg p-4 text-white"
          >
            <p class="text-teal-100 text-sm">Rata-rata Layanan</p>
            <p class="text-2xl font-bold">
              {{if gt .Stats.AvgServiceTime 0}}{{div .Stats.AvgServiceTime
              60}}m{{else}}--{{end}}
            </p>
          </div>
        </div>
      </section>
    </main>
    </div>
</div>

<script src="/templates/pages/admin/js/dashboard.js"></script>

{{template "layouts/_footer.html"}}
